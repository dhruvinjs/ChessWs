// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
 }

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
// interface PlayerTimer 

enum ChessLevel {
  BEGINNER
  INTERMEDIATE
  PRO
}
enum RoomStatus {
  WAITING
  FULL
  ACTIVE
  FINISHED
  CANCELLED
}
enum GameType {
  ROOM 
  RANDOM
}
model User {
  id Int @default(autoincrement()) @id
  name String
  email String @unique
  password String?
  googleId String?
  chessLevel ChessLevel
  gamesWon Game[] @relation("GamesWon")
  gamesLost Game[] @relation("GamesLost")
  createdRooms Room[] @relation("CreatedRooms")
  joinedRooms Room[] @relation("JoinedRooms")
}

model Game {
  id        Int      @id @default(autoincrement())
  moves     Json @default("[]")
  currentFen String
  winnerId  Int? 
  loserId   Int? 
  chat      Json[]  // optional chat history
  whiteTimeLeft Int       @default(600)  // seconds remaining
  blackTimeLeft Int       @default(600)
  lastMoveAt    DateTime?                // when last move was made
  lastMoveBy    String?                  // 'w' or 'b'  
  draw      Boolean  @default(false)
  room      Room?   
  roomId    String @unique
  type GameType @default(ROOM)
  winner User? @relation("GamesWon", references: [id],fields: [winnerId])
  loser User? @relation("GamesLost", references: [id],fields: [loserId])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt 
  endedAt DateTime? 


}

model Room{
  id Int @id @default(autoincrement())
  code String @unique
  createdById Int
  joinedById Int?
  gameId Int? @unique
  status RoomStatus @default(WAITING)  
  createdBy User @relation("CreatedRooms",fields: [createdById],references: [id])
  joinedBy User? @relation("JoinedRooms",fields: [joinedById],references: [id])
  game Game? @relation(fields: [gameId],references: [id])
  createdAt DateTime @default(now())
  updatedAt   DateTime   @updatedAt

}